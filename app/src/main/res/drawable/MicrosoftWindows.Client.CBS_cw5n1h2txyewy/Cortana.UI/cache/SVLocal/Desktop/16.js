var WSB;(function(n){function nr(n,i){var r=[],u,f;if(i)if(n)r=i.slice();else{u=function(n){var t=i.find(function(t){return t.verb&&t.verb.toLocaleLowerCase()==n.toLocaleLowerCase()});t&&r.push(t)};for(f in t)u(f)}return r}function tr(n){return n?n.filter(function(n){return!n.verb||n.verb.toLowerCase()!="open"}):[]}function f(t,i,r,u,f,e){e()&&(t=t.slice(),i.getExtraVerbsAsync?n.Async.safeChain("getExtraVerbsAsync",function(){return i.getExtraVerbsAsync(u)},function(n){return h(g(t,n,!0),i,u,f,e)},function(){return h(t,i,u,f,e)},null,r):h(t,i,u,f,e))}function h(n,t,i,r,u){if(u()){var f=t.getExtraVerbs?g(n,t.getExtraVerbs(i),!1):n;f[0]==y&&f.shift();r(f)}}function ir(i,r,u,f){return i.map(function(i){var e,o,s,h;if(i.verb){switch(i.verb.toLocaleLowerCase()){case vt:e="PinnedToStart";break;case b:e="PinnedToTaskbar";break;case yt:e="UnpinnedFromStart";break;case k:e="UnpinnedFromTaskbar";break;case at:o=n.config.useCobaltCSS?"UninstallMessage":"UninstallConfirmation";e="UninstallationInProgress"}return s=function(t){t();n.RuntimeConfig.AlwaysWide&&e=="UninstallationInProgress"?(r.uninstallationInProgress=!0,f&&f()):e?u.showTemporaryMessage(n.Host.getLocString(e,HitHighlightingParser.removeMarkers(r.text))):u.hideTemporaryMessage();i.verb.toLocaleLowerCase()==b&&n.Host.addItemToPinnedToTaskbar(r.deviceItem.id);i.verb.toLocaleLowerCase()==k&&n.Host.removeItemFromPinnedToTaskbar(r.deviceItem.id)},h=i.icon||t[i.verb.toLocaleLowerCase()],new n.DeviceItemVerbWrapper(i,h,function(t){o&&n.DialogBox?n.DialogBox.show(n.Host.getLocString(o),[{id:null,text:i.displayName,action:function(){return s(t)},selected:!1,useAccentColor:n.config.useCobaltCSS?!0:!1},{id:null,text:n.Host.getLocString("Cancel"),selected:!0}],n.config.useCobaltCSS?n.Host.getLocString("UninstallConfirmationTitle",HitHighlightingParser.removeMarkers(r.text)):""):s(t)})}return i})}function bt(t,i,r,u,e,o){if(n.isJumpListSuggestion(i))return n.Async.safeChain("jumpListItem.getVerbsAsync",function(){return i.jumpListItem.getVerbsAsync()},function(n){return f(tr(n),i,s,u,e,o)},function(){return f([],i,s,u,e,o)},null,t+" "+i.type),!0;var s=t+" "+i.type,c=n.getItemWithFileMetadata(i);return c&&c.canHaveContextMenu?(n.Async.safeChain("item.getVerbsAsync",function(){return c.getVerbsAsync()},function(n){return f(nr(r,n),i,s,u,e,o)},function(){return f([],i,s,u,e,o)},null,s),!0):i.getExtraVerbsAsync?(f([],i,s,u,e,o),!0):i.getExtraVerbs?(h([],i,u,e,o),!0):(u&&e([]),!1)}function e(n,t,i){var r=HitHighlightingParser.removeMarkers(n.text),u=r?r.length:0;return n.additionalInfoText&&!i&&(u+=n.additionalInfoText.length),u>(i?di:gi)}function kt(n){for(var i,r={topResults:n.topResults.slice(0),groups:[]},t=0,u=n.groups;t<u.length;t++)i=u[t],r.groups.push({typeWithSource:i.typeWithSource,suggestions:i.suggestions.slice(0)});return r}function dt(t,i){if(t.isHtmlAnswer)return li;if(t.grid)return(i?n.IconSize_GridLayout:n.IconSize_GridLayout_Medium)+2*r;var u=t.numberOfLines==3?ci:t.numberOfLines==2?hi:si;return t.mainTextWrapsToTwoLines&&(u+=ft),u<ut&&(u=ut),u}function rr(t,i){if(i&&n.uses3lineTemplate(n.getScope(i.type)))return dt({mainTextWrapsToTwoLines:!1,numberOfLines:3,isHtmlAnswer:!1,isSuppressed:t.isSuppressed,grid:!1},!1);if(t.isSuppressed)return 0;var r=ei;return t.hasTwoLines?r+=l+2:t.mainTextWrapsToTwoLines&&(r+=ft),r}function ur(t,i){var r=rt;if(i.typeWithSource&&n.displayedInGridLayout(i.typeWithSource.type)){var u=n.isL2(t),f=Math.ceil(i.suggestions.length/(u?ct:lt)),e=u?et:ot;r+=e*f;r+=2*a}else i.suggestions.forEach(function(n){return r+=rr(n,i.typeWithSource)});return r}function fr(n){switch(n){case 0:return"CP";case 7:return"DI";case 1:return"PP";case 2:return"PD";case 4:return"SP";case 5:return"TP";case 6:return"SD"}return undefined}function g(n,t,i){if(n.length>0&&t.length>0){var r=i?n.concat(y):n;return r.concat(t)}return n.length>0?n:t.length>0?i?[y].concat(t):t:[]}function i(t,i){return t.find(function(t){return n.sameGroup(t.typeWithSource,i)})}function gt(t,i){return t.find(function(t){return n.sameGroup(t.group.typeWithSource,i)})}function ni(n,t){return n.queryToFetch.substring(0,t.queryToFetch.lastIndexOf("\\"))}function ti(t){switch(t){case n.GroupType.TopApps:case n.GroupType.MSNWeather:case n.GroupType.People:return!0}return!1}function er(t,i){if(!t.isSearchHomeZI||t.scope==n.Scope.All||i==n.GroupType.RecommendedDocs)return null;if(t.scope==n.Scope.Web){if(i==n.GroupType.Websites)return n.Host.getLocString("RecentWebsiteSection");if(i==n.GroupType.SearchSuggestions)return n.Host.getLocString("RecentWebSearchSection")}return ti(i)?n.Host.getLocString("FrequentSection"):n.Host.getLocString("RecentSection")}function or(t){return n.Host.getLocString(t?n.getIsMsbEduTenantEnabled()?"SearchSchoolAndWeb":"SearchWorkAndWeb":"SearchTheWeb")}function sr(){return n.Host.getLocString("Websites")}function hr(){return n.SubstrateTenantName?n.Host.getLocString("MsbTenantRecommended").replace("{0}",n.SubstrateTenantName):n.Host.getLocString("QuickWorkSearchSuggestionsSection")}function ii(t,i,r,u){var o,e,f,h,s,c;if(i==n.GroupType.PathCompletion)return o=ni(t,t)+"\\"+String.fromCharCode(8206),{title:o,narratorText:o};if(r&&(e=r.groupDisplayName,e))return{title:e,narratorText:u?n.Host.getLocString("AddingScopeNarratorText",e):e};if(f=er(t,i),!f)switch(i){case n.GroupType.Command:f=n.Host.getLocString("CommandGroup");break;case n.GroupType.Cortana:f=n.Host.getLocString("CortanaGroup");break;case n.GroupType.Store:f=n.Host.getLocString("StoreGroup");break;case n.GroupType.LocalPlaces:f=n.Host.getLocString("LocalPlacesGroup");break;case n.GroupType.Related:f=n.Host.getLocString("RelatedSuggestionsGroup");break;case n.GroupType.SearchSuggestions:f=or(n.msbEnabledForQuery(t));break;case n.GroupType.Websites:f=sr();break;case n.GroupType.Contact:f=n.Host.getLocString("ContactGroup");break;case n.GroupType.LocalSearchHistory:f="Search history";break;case n.GroupType.TopApps:f=n.Host.getLocString("TopAppsSection");break;case n.GroupType.QuickSearch:f=n.Host.getLocString("QuickSearchSuggestionsSection");break;case n.GroupType.QuickWorkSearch:f=hr();break;case n.GroupType.VisualSearch:f="Visual search";break;case n.GroupType.MSNNews:f=n.Host.getLocString(n.config.msnNewsTitleResource);break;case n.GroupType.LockscreenQuickSearch:f=n.Host.getLocString("LockscreenQuickSearchSection");break;case n.GroupType.WelcomeExperience:f=n.Host.getLocString("WelcomeExperienceTitle");break;case n.GroupType.Upsell:f=n.Host.getLocString("RecommendedGroup");break;case n.GroupType.MRUHistory:f=n.Host.getLocString("MRUHistoryGroup");break;case n.GroupType.BingDailyImage:f=n.Host.getLocString("BingImageOfDay");break;case n.GroupType.MSNWeather:f=n.Host.getLocString("Weather");break;case n.GroupType.MeetingPrep:h=r;f=h.timeUntilMeeting;break;case n.GroupType.AnaheimData:r.type=="ANAH"?f=n.Host.getLocString("AnaheimDataHistory"):r.type=="ANAT"?f=n.Host.getLocString("AnaheimDataTopSites"):r.type=="ANAR"&&(f=n.Host.getLocString("AnaheimDataRecentlyClosed"));break;case n.GroupType.RecommendedDocs:f=n.Host.getLocString("RecommendedDocsGroup");break;case n.GroupType.PromoBanner:f=n.Host.getLocString("VaccineUpdate")}if(!f){if(s=n.getScope(i),s==n.Scope.All)throw new Error("Unknown group type: "+i);c=n.ScopeConfig[s];f=n.getScopeDisplayName(c)}return{title:f,narratorText:u?n.Host.getLocString("AddingScopeNarratorText",f.toLocaleLowerCase()):f}}function ri(t,i,r){var u,e=[],o,s;switch(t){case n.GroupType.AnaheimData:case n.GroupType.SearchSuggestions:if(n.canShowAnaheimDataSH(r)||n.canShowAnaheimDataQF()){u="AnaheimDataGroupPopup";s="anaheimDataPopover";break}}if(u){var f=t+"informationBubble",h=s||t+"groupTitlePopover",c=function(){return i.showPopover(n.Host.getLocString(u),e,_ge(f),!0,!0,h)},l=function(t,r){if(r==1){c();return}i.showPopover(n.Host.getLocString(u),e,_ge(f),!0,!1,h)};o={subItem:{id:f,selected:!1,selectedStyleSuspended:!1,narratorText:"",tooltip:"",text:"",onSelected:c},onMouseEnter:l}}return o}var nt=4,tt=6,c=8,r=12,it=1,u=20,l=n.config.useCobaltCSS?20:16,fi=n.config.useCobaltCSS?20:16,ei=n.config.useCobaltCSS?42:u+2*c,rt=n.config.useCobaltCSS?40:fi+2*c,oi=n.config.useCobaltCSS?40:rt,ut=n.config.useCobaltCSS?70:60,si=n.config.useCobaltCSS?50:u+2*r,hi=n.config.useCobaltCSS?70:u+l+nt+2*r,ci=n.config.useCobaltCSS?88:u+2*(l+nt)+2*r,li=80+2*r,ai=n.config.useCobaltCSS?18:c,ft=u,vi=n.config.useCobaltCSS?58:48,a=1,et=n.IconSize_GridLayout+2*(tt+it),ot=n.IconSize_GridLayout_Medium+2*(tt+it),yi=n.config.useCobaltCSS?44:32,pi=8,st=n.config.useCobaltCSS?139:140,wi=156,v=8,bi=510,ki=n.config.useCobaltCSS?572:600,ht=200,ct=3,lt=4,di=n.config.useCobaltCSS?33:39,gi=n.config.useCobaltCSS?33:42,y={},p="runas",w="tabletmode_opennewwindow",at="tile.uninstall",vt="startpin",b="taskbarpin",yt="startunpin",k="taskbarunpin",pt="MRUNoItemsAvailable",d="launchIndexingOptions",o=[{id:"FlyoutNextButton",selected:!1,text:null},{id:"FlyoutButton",selected:!1,text:null},{id:"FlyoutDismissFooterButton",selected:!1,text:null},{id:"flyoutDismissIcon",selected:!1,text:null}],s={id:"SearchBox",selected:!1,text:"SearchBox"},t={},wt,ui;t[p]={content:"&#xE7EF",type:1};t.runasuser={content:"&#xE7EE",type:1};t.openinbrowser={content:"&#xE774",type:1};t.openfilelocation={content:"&#xE838",type:2};t.opencontaining={content:"&#xE838",type:2};t[w]={content:"&#xE8A7",type:2};t[yt]={content:"&#xE77A",type:1};t[k]={content:"&#xE77A",type:1};t[vt]={content:"&#xE718",type:2};t[b]={content:"&#xE718",type:2};t.settings={content:"&#xE713",type:2};t.manage={content:"&#xE912",type:1};t.review={content:"&#xE728",type:2};t.share={content:"&#xE72D",type:1};t.connectnetworkdrive={content:"&#xE8CE",type:1};t.disconnectnetworkdrive={content:"&#xE8CD",type:1};t.uninstall={content:"&#xE74D",type:2};t[at]={content:"&#xE74D",type:2};t.itemproperties={content:"&#xF106",type:2};wt=function(){var t={};return t[n.GroupType.PathCompletion]="GPT",t[n.GroupType.Store]="GT",t[n.GroupType.SearchSuggestions]="GW",t[n.GroupType.WelcomeExperience]="WWE",t[n.GroupType.MRUHistory]="MRUH",t[n.GroupType.QuickSearch]="QSCH",t[n.GroupType.MSNNews]="MSNN",t[n.GroupType.VisualSearch]="SNSC",t}();n.extendVerbs=ir;n.getVerbsAsync=bt;n.wrapsToTwoLines=e;n.joinVerbs=g;n.getGroupTitleAndNarratorText=ii;n.getGroupPopover=ri;ui=function(){function t(t,i,r,u,f,e,o,s,h){var c=this;this._autoComplete=t;this._navigationHelper=i;this._page=r;this._previewPane=u;this._menuFactory=f;this._upsellViewModel=e;this._lightweightStorage=o;this._popoverFactory=s;this._headerFooterViewModel=h;this._pendingSubmitSequenceNumber=-1;this._pendingSubmitModifierKeys=null;this._pendingSubmitTimeStamp=null;this._itemLaunchEventHandlers=[];this.groups=[];this.topResults=[];this._lastUpdatedSequenceNumber=-1;this._topResultsRenderingDisabled=!1;this._groupRenderingDisabled=!1;this._resultsCounter={topResults:[],groups:[]};this._pendingSuggestionsInExistingGroups=[];this._pendingSuggestionsInMissingGroups=[];n.Host.bindShown(function(){c._selectedItem=null});r.setSuggestionClickHandler(this.doubleClickGuardedHandler(function(t,i){c.clickedWeatherButton(i)||n.safeExecute(function(){return c.click(n.getCurrentTime(),t,n.getInputType(i),null)},"suggestionClickHandler")}));r.setContextMenuHandler(function(t,i){n.safeExecute(function(){return c._menuFactory.showContextMenuOnXY(t,i.pageX,i.pageY,function(){return n.Host.setFocusInSearchBox(null,"contextMenuDismiss")})},"contextMenuHandler")});r.setOpenPreviewPaneClickHandler(function(t,i){n.safeExecute(function(){return c.openPreviewPane(t,i)},"openPreviewPaneClickHandler")});r.setExpanderClickInstrumentation(function(t,i,r){var u="Expander"+(r?"Opened":"Closed"),f={st:i,K:t.instItem.getLayoutKValue()};n.InstrumentationHelper.logClientInstEvent("Select",u,null,f)});this._previewPane&&(this._previewPane.init(this),this._previewPane.bindBeforeItemLaunch(function(t,i,r,u,f,e){return n.InstrumentationHelper.instrumentItemClickForPreviewPane(t,i.instItem,i.sequenceNumber,i.instrumentPingBack,r,null,u,f,e)}),this._previewPane.bindAfterItemLaunch(function(n,t,i){return c.onSuggestionLaunch(n,t,i)}));n.Host.bindShown(function(){n.config.setIndexerDefaultValue&&(n.config.searchServiceDisabled=!0);SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.getSearchServiceStatusAsync&&n.Async.safeChain("getSearchServiceStatusAsync",function(){return SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.getSearchServiceStatusAsync()},function(t){n.InstrumentationHelper.setSearchServiceStatus(fr(t));switch(t){case 1:case 2:case 5:case 6:case 7:n.config.searchServiceDisabled=!0;c.showIndexingMessage(!1);break;case 0:case 4:if(n.config.queryIndexerOnRunningOnly){n.config.searchServiceDisabled=!0;c.showIndexingMessage(!0);break}n.config.searchServiceDisabled=!1;break;case 3:n.config.searchServiceDisabled=!1}})});r.bindOnNarratorLaunch(function(t){for(var i,f=n.getCurrentTime(),e=c.getSelectableItems(),r=0,u=e;r<u.length;r++)if(i=u[r],i.id==t){c.isSuggestionOrGroup(i)?(c.select(i,!1),c.submit(f,!1,i.sequenceNumber,null,!0)):c.isScopeElement(i)&&_ge(i.id).click();break}});n.Host.bindSearchBoxGotFocus(function(){c._menuFactory.dismiss();var t=n.getCurrentActiveElement();t&&t.blur();c._selectedItem&&!c.isScopeElement(c._selectedItem)&&c.renderSelectedSuggestionState(!1)});n.Host.bindSearchBoxLostFocus(function(){var t=c.isScopeTile(n.getCurrentActiveElement());t?n.safeSetTimeout(function(){n.Host.searchBoxHasFocus()||c.isScopeElement(c._selectedItem)||c.renderSelectedSuggestionState(!0)},75,"RootViewModel.bindSearchBoxLostFocus"):c.renderSelectedSuggestionState(!0)});sj_evt.bind("CortanaPaneWidthSet",function(n){return c.onPaneWidthSet(n[1])});sj_be(_ge("qfContainer"),"scroll",function(){c._menuFactory.dismiss();c._popoverFactory&&c._popoverFactory.dismiss()});this._iconRenderInfos=[]}return t.prototype.isScopeTile=function(n){return n&&n.classList.contains("scopeTile")},t.prototype.onDismiss=function(){this.topResults=[];this.renderTopResults(!0);this.groups=[];this.renderGroups(!0);this._partialQuery=null;this._lastUpdatedSequenceNumber=-1;this._pendingSuggestionsInExistingGroups=[];this._pendingSuggestionsInMissingGroups=[];this.toggleProgressBar(!1);this._menuFactory.dismiss();this._previewPane&&n.RuntimeConfig.PreviewPaneAvailable&&this._previewPane.dismiss();this._page.hideTemporaryMessage();this.hideIndexingMessage();n.DialogBox&&n.DialogBox.hide();this._headerFooterViewModel&&this._headerFooterViewModel.render(null,!1,!1,!1,!0);n.Host.setSearchBoxGlyphIcon()},t.prototype.bindItemLaunch=function(n){this._itemLaunchEventHandlers.push(n)},t.prototype.onPaneWidthSet=function(n){lt=Math.floor((n-2*a)/ot);ct=Math.floor((n-2*a)/et)},t.prototype.setSelectedStyleSuspended=function(t,i){t.selectedStyleSuspended=i&&n.Host.isRequestFocusAvailable()},t.prototype.renderSelectedSuggestionState=function(n){this._selectedItem&&(this.setSelectedStyleSuspended(this._selectedItem,n),this.renderSelection(this._selectedItem))},t.prototype.toggleProgressBar=function(t){var i=this;n.config.dataSourcesWithProgressBar.length>0&&(this._progressTimer&&(sb_ct(this._progressTimer),this._progressTimer=null),t?(this._partialQuery.showProgressBar||this._partialQuery.queryToFetch=="")&&(this._progressTimer=n.safeSetTimeout(function(){i._progressTimer&&(i._page.setProgressIndicatorVisibility(!0),i._progressTimer=null)},250,"showProgress")):n.config.dataSourcesWithProgressBar.length>0&&(this._progressTimer&&(sb_ct(this._progressTimer),this._progressTimer=null),this._page.setProgressIndicatorVisibility(!1)))},t.prototype.resetPendingSubmitSequenceNumber=function(){this._pendingSubmitSequenceNumber=null;this._pendingSubmitModifierKeys=null;this._pendingSubmitTimeStamp=null},t.prototype.onAfterKeyDown=function(t,i,r,u){var e,f,v,s,h,c,y,p,l,a;if(!this._partialQuery||!this._menuFactory.isMenuVisible()&&(!this._popoverFactory||!this._popoverFactory.isPopoverVisible())&&t==13)return!1;if(e=i&&i.shiftKey,n.DialogBox&&n.DialogBox.isVisible())return t!=9||u||this.handleCrossViewModelsTabKeyNavigation(null,e),!0;if(f=this._previewPane&&this._previewPane.hasFocus(),v="rvm onAfterKeyDown",this._page.hideTemporaryMessage(),this.resetPendingSubmitSequenceNumber(),!r&&n.isContextMenuKey(t,e)&&!f)return this.tryShowContextMenuOnSelectedSuggestion(),!0;if(this._menuFactory.isMenuVisible()){if(t==37||t==39||t==13||n.isUpOrDownKey(t)){if(s=this._menuFactory.onAfterKeyDown(t,i,r,u),s)return!0;if(n.isUpOrDownKey(t))return!1}else if(t==9)return this._menuFactory.dismiss(!0),!0;this._menuFactory.dismiss(!0)}if(this._popoverFactory&&this._popoverFactory.isPopoverVisible()){if(t==37||t==39||t==13||n.isUpOrDownKey(t)){if(s=this._popoverFactory.onAfterKeyDown(t,i,r,u),s)return!0;if(t==37||t==39)return!1}this._popoverFactory.dismiss(!1)}if(n.RuntimeConfig.QfMode==5&&t==46)return(h=this._selectedItem,h&&h.removeIcon)?(h.removeIcon.click(n.getCurrentTime(),1),!0):!1;if(c=n.getCurrentActiveElement(),!this.isScopeTile(c)||f||this._menuFactory.isMenuVisible()||this._popoverFactory&&this._popoverFactory.isPopoverVisible()||t!=39&&t!=37){if(t==9)n.config.allowTabToSelectSuggestions||e||!this._selectedItem||f||this.isScopeElement(this._selectedItem)?u||this.handleCrossViewModelsTabKeyNavigation(c,e):this.select(this._headerFooterViewModel.getSelectableItems()[0],!1);else if(n.RuntimeConfig.PreviewPaneAvailable&&this._previewPane&&this._selectedItem&&!this.isScopeElement(this._selectedItem)){this._previewPane.onAfterKeyDownWhenNewSelection(t,this._partialQuery,this._selectedItem);if(f)return!0}}else y=n.getRtlAdjustedKey(t),this._headerFooterViewModel.focusNextScopeTile(c,y==39),p=this._headerFooterViewModel.getSelectableItems(),this.select(p[0],!1);return f=this._previewPane&&this._previewPane.hasFocus(),this._selectedItem&&(n.isUpOrDownKey(t)||t==9)&&!f&&(l=this.isScopeElement(this._selectedItem),l||this._selectedItem==this.topResults[0]?this._page.scrollToTop():this._page.scrollTo(this._selectedItem),a=v+"-AdjustFocus",l||this.isAdvancedOption(this._selectedItem)||this.isFlyout(this._selectedItem)?(this.isAdvancedOption(this._selectedItem)&&this._selectedItem.id!==d?_ge(this._selectedItem.id).querySelector("input").focus():_ge(this._selectedItem.id).focus(),n.Host.searchBoxHasFocus()&&n.Host.setFocusInWebView(a)):t!=9&&n.Host.searchBoxHasFocus()||n.Host.setFocusInSearchBox(t,a)),this.isFlyoutVisible()&&o.indexOf(this._selectedItem)>=0&&(t==39?this.selectNextFlyoutItem(1):t==37&&this.selectNextFlyoutItem(-1)),!1},t.prototype.isFlyoutVisible=function(){return n.config.enableEducationalFlyout&&!_ge("flyoutContainer").classList.contains("b_hide")},t.prototype.selectNextFlyoutItem=function(n){if(this.isFlyoutVisible()){var t=o.filter(function(n){return _ge(n.id)}),r=t.indexOf(this._selectedItem),i=(r+n)%t.length;this._selectedItem=t[i>=0?i:t.length-1];_ge(this._selectedItem.id).focus()}},t.prototype.handleCrossViewModelsTabKeyNavigation=function(t,i){var a=n.RuntimeConfig.PreviewPaneAvailable&&!!this._previewPane,o=a&&this._previewPane.isOpened(),v=o&&this._previewPane.hasFocus(),e,s,f,l,u,h,c,r;n.DialogBox&&n.DialogBox.isVisible()?(e=n.DialogBox.getSelectableItemsByGroup(),i?this.select(e[e.length-1][0],!1):this.select(e[0][0],!1)):v?i?(this._previewPane.blur(),r=null,this._headerFooterViewModel&&(s=this._headerFooterViewModel.getSelectableItemsByGroup(),r=s[s.length-1][0]),this.select(r,!1)):(this._previewPane.blur(),u=this.getSelectableItems(),this.select(u[0],!0)):this.isScopeTile(t)?!o||i?(f=this.getSelectableSuggestionsByGroup(!0),f.length>0?(l=i?f[f.length-1][0]:f[0][0],this.select(l,!0)):(u=this.getSelectableItems(),u.length>0?this.select(u[0],!0):this.select(null,!0)),h="handleCrossBordersNavigationWithTab",n.safeSetTimeout(function(){return n.Host.setFocusInSearchBox(9,h)},0,h)):(this.select(this._previewPane.getPreviewedSuggestion(),!0),this._previewPane.focus(!0)):this._selectedItem?i?o?this._previewPane.focus():(c=this.getSelectableItemsByGroup(),r=c[c.length-1][0],this.select(r,!1)):this.select(this.getSelectableItemsByGroup()[0][0],!1):this.select(this.getSelectableItemsByGroup()[0][0],!1)},t.prototype.tryShowContextMenuOnSelectedSuggestion=function(){var i=this,t=this._selectedItem&&this.isSuggestion(this._selectedItem)?this._selectedItem:null;t&&n.safeExecute(function(){return i._menuFactory.showContextMenuOnElement(t,_ge(t.id),function(){return n.Host.setFocusInSearchBox(null,"contextMenuDismiss")})},"contextMenuHandler")},t.prototype.onQueryChanged=function(t,i){var s=this,h,u,f,e,c,l,o,a,r;if(n.DialogBox&&n.DialogBox.hide(),this._menuFactory.dismiss(),!this._partialQuery||!this._partialQuery.equals(t)){if(this._page.hideTemporaryMessage(),n.config.dataSourcesWithProgressBar.length>0&&(this._progressTimer&&(sb_ct(this._progressTimer),this._progressTimer=null),t.showProgressBar?this._progressTimer=n.safeSetTimeout(function(){s._progressTimer&&(s._page.setProgressIndicatorVisibility(!0),s._progressTimer=null)},250,"showProgress"):this._page.setProgressIndicatorVisibility(!1)),this._partialQuery&&this._partialQuery.scope!=t.scope&&(this._turnOnIndexingInstItem||this.hideIndexingMessage()),h=this._partialQuery?this._partialQuery.queryToFetch:"",u=t.queryToFetch,this._previewPane&&n.RuntimeConfig.PreviewPaneAvailable)this._previewPane.onQueryChanged(t);for(this._partialQuery=t,f=!1,e=0,c=this.topResults;e<c.length;e++)r=c[e],r.updateFromQuery&&!r.hasPreviewPaneOpened?r.updateFromQuery(t)&&(f=!0):u.length>h.length&&u.startsWith(h)&&r.query.toLowerCase().includes(t.queryToFetch.toLowerCase())&&(l=r.text.indexOf(HitHighlightingParser.endMarker),l>=0&&l<r.text.length-1&&(r.text=HitHighlightingParser.addMarkers(HitHighlightingParser.removeMarkers(r.text),u),f=!0));if(f){for(o=0,a=this.topResults;o<a.length;o++)r=a[o],r.sequenceNumber=i,this.updateNarratorWithPreviewMessage(r);this.renderTopResults()}this.resetIconTimers();this._iconRenderInfos=[]}},t.prototype.onSuggestionsParsed=function(t,i,r,u,f){var s=t.enabledDataSources[r].groupType,e,o,h;if(typeof s=="number")for(e=0,o=f;e<o.length;e++)h=o[e],h.staticGroupType=s;(u==="NI"||u==="PI")&&(r=="PP"||r=="ST"||t.scope!=n.Scope.All)&&n.RuntimeConfig.ScopesAvailable&&t.scope!=n.Scope.Web&&this.showIndexingMessage(!0)},t.prototype.areSuggestionsPresent=function(){return this.topResults.length>0||this.groups.length>0&&this.groups.some(function(n){return n.suggestions.length>0})},t.prototype.getSuggestions=function(n){var t=this.getCurrentTopResults();return this.groups.forEach(function(n){return t=t.concat(n.suggestions)}),n&&(this._pendingSuggestionsInExistingGroups.forEach(function(n){return t=t.concat(n.suggestions)}),this._pendingSuggestionsInMissingGroups.forEach(function(n){return t=t.concat(n.suggestions)})),t},t.prototype.getSelectableItems=function(){var t,r,u,i,f;if(n.DialogBox&&n.DialogBox.isVisible())return n.DialogBox.getSelectableItems();if(this._menuFactory.isMenuVisible())return this._menuFactory.getSelectableItems();if(this._previewPane&&this._previewPane.hasFocus())return this._previewPane.getSelectableItems();for(t=[],this._launchIndexingDataModel&&t.push(this._launchIndexingDataModel.action),t.push.apply(t,this.topResults),r=0,u=this.groups;r<u.length;r++)i=u[r],i.click&&t.push(i),i.popover&&t.push(i.popover.subItem),f=i.suggestions.filter(function(n){return!n.suppressed}),f.forEach(function(n){n.unselectable||t.push(n);n.subItems&&t.push.apply(t,n.subItems.filter(function(n){return!n.disabled}))});return this.areSuggestionsPresent()||t.push(s),n.config.allowUpForScopes&&this._headerFooterViewModel&&t.push.apply(t,this._headerFooterViewModel.getSelectableItems()),t},t.prototype.getSelectableSuggestionsByGroup=function(t){if(n.config.allowTabToSelectSuggestions){var i=[];return i.push(this.topResults),this.groups.forEach(function(n){n.click&&i.push([n]);n.popover&&i.push([n.popover.subItem]);var t=[],r=n.suggestions.filter(function(n){return!n.suppressed});r.forEach(function(n){n.unselectable||t.push(n);n.subItems&&t.push.apply(t,n.subItems.filter(function(n){return!n.disabled}))});i.push(t)}),!t&&this._headerFooterViewModel&&i.push(this._headerFooterViewModel.getSelectableItems()),i.filter(function(n){return n.length>0})}return[]},t.prototype.getSelectableItemsByGroup=function(){if(n.DialogBox&&n.DialogBox.isVisible())return n.DialogBox.getSelectableItemsByGroup();if(this._menuFactory.isMenuVisible())return this._menuFactory.getSelectableItemsByGroup();if(this._previewPane&&this._previewPane.hasFocus())return this._previewPane.getSelectableItemsByGroup();var t=[];return this.isFlyoutVisible()&&t.push([o.find(function(n){return!!_ge(n.id)})]),this._headerFooterViewModel&&t.push.apply(t,this._headerFooterViewModel.getSelectableItemsByGroup()),this._launchIndexingDataModel&&t.push([this._launchIndexingDataModel.action]),this.areSuggestionsPresent()?t.push.apply(t,this.getSelectableSuggestionsByGroup(!0)):t.push([s]),t},t.prototype.getSelectedItem=function(){return n.DialogBox&&n.DialogBox.isVisible()?n.DialogBox.getSelectedItem():this._menuFactory.isMenuVisible()?this._menuFactory.getSelectedItem():this._previewPane&&this._previewPane.hasFocus()?this._previewPane.getSelectedItem():this._selectedItem?this._selectedItem:s},t.prototype.updateSelectionState=function(t){n.contains(this.topResults,t)?this.renderTopResults():this.groups.some(function(i){return n.contains(i.suggestions,t)})&&this.renderGroups()},t.prototype.isSubItem=function(n){return n&&typeof n.itemView!="undefined"},t.prototype.getSuggestionById=function(n){for(var i,t=0;t<this.groups.length;t++)for(i=0;i<this.groups[t].suggestions.length;i++)if(this.groups[t].suggestions[i].id==n)return this.groups[t].suggestions[i];return null},t.prototype.selectGroupItem=function(n){for(var s,r,e,u,o,t,i=0,f=this.groups;i<f.length;i++)for(s=f[i],r=0,e=s.suggestions;r<e.length;r++)t=e[r],t.reactKey==n.reactKey?(t.selected=!0,this._selectedItem=t):t.selected=!1;for(u=0,o=this.topResults;u<o.length;u++)t=o[u],t.reactKey==n.reactKey?(t.selected=!0,this._selectedItem=t):t.selected=!1},t.prototype.doesGroupsContain=function(n){for(var f,i,u,e,t=0,r=this.groups;t<r.length;t++)for(f=r[t],i=0,u=f.suggestions;i<u.length;i++)if(e=u[i],e.reactKey==n.reactKey)return!0;return!1},t.prototype.renderSelection=function(t,i){var r,u;this.isSubItem(t)&&(t=this.getSuggestionById(t.suggestionId));i&&this.isSubItem(i)&&(i=this.getSuggestionById(i.suggestionId));(t&&this.isSuggestion(t)&&n.contains(this.topResults,t)||i&&this.isSuggestion(i)&&n.contains(this.topResults,i))&&this.renderTopResults();this._headerFooterViewModel&&(t&&this.isAdvancedOption(t)||i&&this.isAdvancedOption(i))&&this._headerFooterViewModel.updateTopHitHeader();t&&((u=(r=this._launchIndexingDataModel)===null||r===void 0?void 0:r.action)===null||u===void 0?void 0:u.id)===d&&this._page.updateIndexingMessageView(this._launchIndexingDataModel);(t&&n.isGroup(t)&&n.contains(this.groups,t)||t&&this.isSuggestion(t)&&this.doesGroupsContain(t)||i&&n.isGroup(i)&&n.contains(this.groups,i)||i&&this.isSuggestion(i)&&this.groups.some(function(t){return n.contains(t.suggestions,i)}))&&this.renderGroups()},t.prototype.renderGroups=function(t){var e,r,i,u,f;this._partialQuery&&(i=this._partialQuery.queryToFetch?n.config.maxSuggestionsPerGroup:0,i&&i>0&&this.groups.forEach(function(n,t,r){r[t].suggestions=n.suggestions.slice(0,i)}));this._groupRenderingDisabled||(n.config.msbQwsShowRecommendedDocs&&n.getIsMsbInternalTenant()&&((r=this._contentQuery)===null||r===void 0?void 0:r.isSearchHomeZI)&&(u=this.groups.filter(function(t){return t.type===n.GroupType.QuickWorkSearch})[0],f=this.groups.filter(function(t){return t.type===n.GroupType.RecommendedDocs})[0],u&&f&&((e=u.suggestions).push.apply(e,f.suggestions),this.groups=this.groups.filter(function(t){return t.type!==n.GroupType.RecommendedDocs}))),this._page.updateGroupsView({query:this._contentQuery,topResults:this.topResults,groups:this.groups},t),n.InstrumentationHelper.updateSuggestionsList(this.topResults,this.groups))},t.prototype.select=function(t,i){var f,r,u;(n.cohortProfileManager===null||n.cohortProfileManager===void 0?void 0:n.cohortProfileManager.isTourVisible())&&((f=t===null||t===void 0?void 0:t.id)===null||f===void 0?void 0:f.toLowerCase().search(/flyout/i))==-1||(n.DialogBox&&n.DialogBox.isVisible()?n.DialogBox.select(t):this._menuFactory.isMenuVisible()&&n.contains(this._menuFactory.getSelectableItems(),t)?this._menuFactory.select(t,!1):this._previewPane&&n.contains(this._previewPane.getSelectableItems(),t)?this._previewPane.select(t,!1):(r=this._selectedItem,r&&(r.selected=!1,this.setSelectedStyleSuspended(r,!1)),t==s?(this._selectedItem=null,n.Host.searchBoxHasFocus()||n.Host.setFocusInSearchBox(null,"rvm_select")):(this._selectedItem=t,t&&(t.selected=!0,this.setSelectedStyleSuspended(t,!n.Host.searchBoxHasFocus()))),this.renderSelection(this._selectedItem,r),this.isScopeElement(t)&&this._headerFooterViewModel.select(t,!1),i&&(u=t?t.query:null,u&&this._partialQuery.scopePrefix&&(u=this._partialQuery.scopePrefix.trim()+": "+u),n.Host.updateQueryWithoutRefetching(u))))},t.prototype.resetIconTimers=function(n,t){var o=typeof n=="undefined"||!n,s=typeof n=="undefined"||n,i,f,u,e,r;if(o){if(t)for(i=0,f=this._renderGroupsIconsCBs;i<f.length;i++)r=f[i],r();this._renderGroupsIconsCBs=[];this._renderGroupsTimerForIcons&&(sb_ct(this._renderGroupsTimerForIcons),this._renderGroupsTimerForIcons=null)}if(s){if(t)for(u=0,e=this._renderTopResultsIconsCBs;u<e.length;u++)r=e[u],r();this._renderTopResultsIconsCBs=[];this._renderTopResultsTimerForIcons&&(sb_ct(this._renderTopResultsTimerForIcons),this._renderTopResultsTimerForIcons=null)}},t.prototype.setupIcon=function(i,r,u,f){var e=this,o,s,h;if(n.config.noFetchIcons||n.config.reactGroups){f();return}if(o=function(){u.isTopResult?e.renderTopResults():e.renderGroups();e.resetIconTimers(u.isTopResult,!0)},s=function(t){u.iconsPendingReturn==0?(o(),t&&t()):u.isTopResult?(t&&e._renderTopResultsIconsCBs.push(t),e._renderTopResultsTimerForIcons||(e._renderTopResultsTimerForIcons=n.safeSetTimeout(function(){e._renderTopResultsTimerForIcons=null;o()},ht,"renderTRIconsAsync"))):(t&&e._renderGroupsIconsCBs.push(t),e._renderGroupsTimerForIcons||(e._renderGroupsTimerForIcons=n.safeSetTimeout(function(){e._renderGroupsTimerForIcons=null;o()},ht,"renderGRPIconsAsync")))},++u.iconsPendingReturn,!r.suppressed&&r.getIcon)n.InstrumentationHelper.notifyIconPending(i,u.isTopResult),h=this._partialQuery,r.getIcon(t.getImageSize(h,r,u.isTopResult),function(t){r.icon=t;var o=function(){--u.iconsPendingReturn;e._partialQuery&&i==n.SequenceNumberManager.getSequenceNumber()&&(n.InstrumentationHelper.notifyIconReadyOrFailed(i,u.isTopResult),(u.isTopResult&&n.contains(e.topResults,r)||!u.isTopResult&&e.groups.some(function(t){return n.contains(t.suggestions,r)}))&&s(f))};n.populateImageRatio(r.icon,r.type,o)});else if(!r.suppressed&&r.icon&&n.canIconFail(r.icon)){n.InstrumentationHelper.notifyIconPending(i,u.isTopResult);var c=r.icon.getFallbackIcon,l=function(n,t){return t(r.icon)},a=r.icon.isValidSize,v=function(){r.getIcon=c;e.setupIcon(i,r,u,f);n.InstrumentationHelper.notifyIconReadyOrFailed(i,u.isTopResult)},y=function(){r.icon.isSmall=!0;r.getIcon=l;e.setupIcon(i,r,u,f);n.InstrumentationHelper.notifyIconReadyOrFailed(i,u.isTopResult)};r.icon.onIconError=v;r.icon.onIconRendered=function(t,e){a(t,e)||r.icon.isSmall?(n.InstrumentationHelper.notifyIconReadyOrFailed(i,u.isTopResult),f()):y()};--u.iconsPendingReturn;s()}else--u.iconsPendingReturn,f()},t.getImageSize=function(t,i,r){return t.isSearchHomeZI?i.type=="TOPL"?7:8:t.scope==n.Scope.Apps&&!t.queryToFetch?3:n.displayedInGridLayout(i.type)?2:r?0:1},t.prototype.isSuggestionOrGroup=function(n){return!this.isScopeElement(n)},t.prototype.isSuggestion=function(t){return!n.isGroup(t)&&!this.isScopeElement(t)&&!this.isAdvancedOption(t)},t.prototype.isAdvancedOption=function(n){return typeof n.layout=="number"},t.prototype.isFlyout=function(n){return this.isFlyoutVisible()&&o.indexOf(n)>=0},t.prototype.isBodyOrSuggestion=function(n){return n&&(n.tagName.toLowerCase()=="body"||n.tagName.toLowerCase()=="iframe"||n.className&&n.classList.contains("suggestion"))},t.prototype.submit=function(t,i,r,u,f){var s=f?5:i?6:1,c=n.getCurrentActiveElement(),e,o,h,l;if(n.DialogBox&&n.DialogBox.isVisible()){n.DialogBox.submit();return}if(this._previewPane&&this._previewPane.hasFocus()){if(e=this._previewPane.getSelectedItem(),e&&e.click&&e.optionType===undefined){e.click(t,s);return}}else if(!this._selectedItem||!this.isScopeElement(this._selectedItem)||this._menuFactory.isMenuVisible()||this._popoverFactory&&this._popoverFactory.isPopoverVisible()){if((n.RuntimeConfig.QfMode==5||n.RuntimeConfig.QfMode==9)&&!this._selectedItem){n.Host.submitFileExplorerTextSuggestion(this._partialQuery.queryToFetch);return}}else{_ge(this._selectedItem.id).click();return}if(o=this._menuFactory.getSelectedItem(),o){o.click&&o.click(t,s,u);return}if(h=this._popoverFactory?this._popoverFactory.getSelectedItem():null,h){this._popoverFactory.submit(h);return}if(l=!this.isBodyOrSuggestion(c),l){n.Host.isRequestFocusAvailable()||c.click();return}if(this._lastUpdatedSequenceNumber!=r&&(!this._selectedItem||this._selectedItem==this.topResults[0])){this._pendingSubmitSequenceNumber=r;this._pendingSubmitModifierKeys=u;this._pendingSubmitTimeStamp=t;return}this._selectedItem?this.click(t,this._selectedItem,s,u):this.groups.length>0&&this._partialQuery.fullPartialQuery&&this.showDisableEnterMessage()},t.prototype.doubleClickGuardedHandler=function(t){var i;return function(r,u){i&&n.getCurrentTime()-i<=250||(i=n.getCurrentTime(),t(r,u))}},t.prototype.click=function(t,i,r,u){if(this._page.hideTemporaryMessage(),this.isAdvancedOption(i)){i.click&&i.click(t,r,u);return}var f=n.isGroup(i)||this.isSubItem(i)?null:i;if(!i.instItem||f&&f.isReformulation||n.InstrumentationHelper.instrumentItemClick(t,i.instItem,i.sequenceNumber,f?f.instrumentPingBack:null,r,u),!f){i.click&&i.click(t,r,u);return}u=u||n.Host.getModifierKeyState();u.ctrlKey&&u.shiftKey?this.launchVerb(f,p,t):u.shiftKey?this.launchVerb(f,w,t):f.click(t,r,u);this.onSuggestionLaunch(f,this._partialQuery)},t.prototype.onSuggestionLaunch=function(t,i,r){n.isChildSuggestion(t)&&(t=t.parent);this._itemLaunchEventHandlers.forEach(function(n){return n(t,i,r)})},t.prototype.launchVerb=function(t,i,r){var u=bt("launchVerb",t,n.config.rawVerbs,!1,function(u){for(var s,h,e=!1,c=function(t){if(t.verb&&t.verb.toLocaleLowerCase()==i.toLocaleLowerCase())return t.executeSync?n.safeExecute(function(){return t.executeSync()},"verb.executeSync",null,i):n.Async.safeChain("verb.executeAsync",function(){return t.executeAsync()},function(){return n.Host.manuallyDismissApp()},null,null,i),e=!0,"break"},f=0,o=u;f<o.length;f++)if(s=o[f],h=c(s),h==="break")break;e||t.click(r,0)},function(){return!0});u||t.click(r,0)},t.prototype.getGroupHeaderClickAction=function(t,i,r,u){var h=this,f,e,o=null,s=null,c,l,a;if(n.RuntimeConfig.ScopesAvailable&&(c=n.getScope(i.type),c!=n.Scope.All))if(i.type==n.GroupType.SearchSuggestions&&t.isSearchHomeZI)e=n.Host.getLocString("OpenPrivacyPortalButtonText"),o=n.Host.getLocString("ManageSearchHistory"),f=function(){return n.Host.launchPrivacyPortal()};else return n.isL2(t)||!n.isScopeEnabled(c,n.ScopeConfig[c])?[null,null,null,null,null]:(l=function(){return h._headerFooterViewModel.clickHandler(c,"groupHeader",i)},[l,null,null,null,null]);if(!f)switch(i.type){case n.GroupType.Store:f=function(){return n.Host.launchStoreSearch(t.queryToFetch)};break;case n.GroupType.SearchSuggestions:f=function(){return h.launchSearch(t,r)};break;case n.GroupType.PathCompletion:f=function(){return n.Host.launchFolder(ni(t,h._partialQuery))};break;case n.GroupType.MSNNews:if(!n.config.msnNewsAlternativeUX)return e=n.Host.getLocString("QuickSearchSuggestionsSection"),o=n.Host.getLocString("MSNNewsQuickSearchHover"),f=function(){h._lightweightStorage.setItem(n.currentTabStorageKey,n.MSNNewsTabs.QuickSearches);n.Host.refreshCurrentPane();n.InstrumentationHelper.logClientInstEvent("Select","MSNNewsTabChange",null,{newtab:"QuickSearches"})},[f,null,e,o,s];break;case n.GroupType.Upsell:if(t.isSearchHomeZI)return s={content:"&#xE711",type:2},e=n.Host.getLocString("DismissUpsell"),o=n.Host.getLocString("DismissUpsell"),f=this._upsellViewModel.getDismissButtonAction(t),[f,null,e,o,s];break;case n.GroupType.MeetingPrep:return s={content:"&#xE711",type:2,narratorText:n.Host.getLocString("DismissMeeting")},e=n.Host.getLocString("DismissMeeting"),o=n.Host.getLocString("DismissMeeting"),f=u.dismissAction,[f,null,e,o,s];case n.GroupType.QuickSearch:if(n.config.msnNewsSearch&&n.shouldEnableMSNNewsSearches(n.getCurrentLanguage()))return e=n.Host.getLocString(n.config.msnNewsTitleResource),o=n.Host.getLocString(n.config.msnNewsHoverResource),f=function(){h._lightweightStorage.setItem(n.currentTabStorageKey,n.MSNNewsTabs.News);n.Host.refreshCurrentPane();n.InstrumentationHelper.logClientInstEvent("Select","MSNNewsTabChange",null,{newtab:"MSNNews"})},[f,null,e,o,s];break;case n.GroupType.WelcomeExperience:if(n.config.enableWWETour&&n.RuntimeConfig.PreviewPaneAvailable&&SearchAppWrapper.CortanaApp.height>=615)return s={content:"&#xE711",type:2},e=n.Host.getLocString("DismissUpsell"),o=n.Host.getLocString("DismissUpsell"),f=function(){return h.dismissTour(t)},[f,null,e,o,s];break;case n.GroupType.BingDailyImage:if(n.canShowBingDailyImage(this._lightweightStorage))return s={content:"&#xE711",type:2,className:"bingImageDismissGroup"},e=n.Host.getLocString("DismissBingImage"),o=n.Host.getLocString("DismissBingImage"),f=function(){h._lightweightStorage.setItem("BingImageDismissed","1");n.Host.refreshCurrentPane();n.InstrumentationHelper.logClientInstEvent("Select","BingImageDismiss",null)},[f,null,e,o,s];break;case n.GroupType.AnaheimData:if(n.canShowAnaheimDataSH(this._lightweightStorage))return s={content:"&#xE711",type:2,className:"anaheimDataDismissGroup"},e=n.Host.getLocString("DismissAnaheimData"),o=n.Host.getLocString("DismissAnaheimData"),f=function(){h._lightweightStorage.setItem("AnaheimDataDismissed","1");n.Host.refreshCurrentPane()},[f,null,e,o,s];break;case n.GroupType.PromoBanner:return s={content:"&#xE711",type:2},e=n.Host.getLocString("DismissUpsell"),o=n.Host.getLocString("DismissUpsell"),f=this._upsellViewModel.getDismissButtonAction(t),[f,null,e,o,s]}if(f){if(!r)throw"No QS code for: "+n.GroupType[i.type];return a=n.InstrumentedItem.getNonSuggestionInstrumentedItem(r,n.SyntheticQSCodesMaps.KValues),[f,a,e,o,s]}return[null,null,null,null,null]},t.prototype.shouldShowPlusIconInGroupHeader=function(t,i){if(n.getScope(t)==n.Scope.Web||t==n.GroupType.Store)return!1;if(t==n.GroupType.Apps&&this._partialQuery.queryToFetch.length<n.config.minLengthForIBAonL1)return!0;if(t==n.GroupType.Apps||t==n.GroupType.Settings){var r=i[t==n.GroupType.Apps?"PP":"ST"];return!(r&&r.maxedOut)}return!0},t.prototype.shouldHideGroupHeader=function(t){return t===n.GroupType.MSNWeather||t===n.GroupType.TopApps&&this._partialQuery.scope==n.Scope.All&&n.shouldEnableWeatherTile(n.getCurrentLanguage())&&!n.config.prong1?n.isWeatherTileVisible(this._lightweightStorage):t===n.GroupType.QuickSearch&&n.shouldEnableMSNNewsSearches(n.getCurrentLanguage())&&n.canShowMSNNewsTab(this._lightweightStorage)||t===n.GroupType.VisualSearch||t===n.GroupType.MSNNews&&n.config.msnNewsAlternativeUX?!0:!1},t.prototype.addGroup=function(t,r,u,f,e){var s,y;if(i(this.groups,t))throw new Error("Trying to add repeated group "+t);var p=wt[t.type],h=this.getGroupHeaderClickAction(this._partialQuery,t,p,r),c=h[0],l=h[1],w=h[2],d=h[3],b=h[4],a=ii(this._partialQuery,t.type,r,!!c);t.source&&(a.title+=" - "+n.getGroupSourceDisplayName(t.source));var g=ri(t.type,this._popoverFactory,this._lightweightStorage),o=[],v=undefined,k=undefined;return n.isTopHitChildGroup(t)?o.push("topHitConnectedToGroup"):t.type==n.GroupType.TopApps||this._partialQuery.isSearchHomeZI&&t.type==n.GroupType.People?o.push("topItemsGroup"):t.type==n.GroupType.QuickSearch?o.push("balloonSuggGroup"):t.type==n.GroupType.QuickWorkSearch?(o.push("quickWorkSearchGroup"),n.config.msbHideTopApp&&n.getIsMsbInternalTenant()&&o.push("topMostGroup"),n.config.msbShowLogoInSearchHome&&(s=n.getMsbBranding(this._lightweightStorage),v=s===null||s===void 0?void 0:s.logoDataUri,k=s===null||s===void 0?void 0:s.backColor,v&&o.push("groupWithImageHeader"))):t.type==n.GroupType.VisualSearch?o.push("snipSuggGroup"):t.type==n.GroupType.MSNNews?o.push("msnNewsGroup"):t.type==n.GroupType.LockscreenQuickSearch?o.push("lockscreenQuickSuggGroup"):t.type==n.GroupType.WelcomeExperience?o.push("welcomeExperience"):t.type==n.GroupType.Upsell?o.push("upsellSuggGroup"):t.type==n.GroupType.MeetingPrep?o.push("meetingPrepSuggGroup"):t.type==n.GroupType.PromoBanner?o.push("skypePromoSuggGroup"):t.type==n.GroupType.BingDailyImage?o.push("bingImageGroup"):t.type==n.GroupType.MSNWeather?o.push("msnWeatherGroup"):t.type==n.GroupType.MRUHistory?o.push("mruHistory"):t.type==n.GroupType.RecommendedDocs||t.type==n.GroupType.Documents&&n.isRecommendedDocsGroupEnabled(this._partialQuery)?(o.push("recommendedDocsGroup"),n.config.msbHideTopApp&&n.getIsMsbInternalTenant()&&o.push("topMostGroup")):t.type==n.GroupType.AnaheimData&&o.push("anaheimDataGroup"),y={type:t.type,typeWithSource:t,id:"gr"+t.type+(t.source||""),text:a.title,headerImageDataUri:v,headerBackColor:k,secondaryText:w,secondaryIcon:b,narratorText:a.narratorText,tooltip:d,click:(n.cohortProfileManager===null||n.cohortProfileManager===void 0?void 0:n.cohortProfileManager.isTourVisible())?null:c,onlyAnnotationIsClickable:c&&(!!w||!!b),suggestions:[],instRegionName:n.GroupType[t.type],instItem:l,selected:!1,cssClasses:o.join(" ")||undefined,sequenceNumber:u,showPlusIconInHeader:this.shouldShowPlusIconInGroupHeader(t.type,e),hideGroupHeader:this.shouldHideGroupHeader(t.type),popover:g},l&&n.InstrumentationHelper.instrumentSyntheticInstrumentedItem(u,p,l),this._resultsCounter.groups.push({typeWithSource:t,suggestions:[]}),this.insertGroup(y,f),y},t.prototype.insertGroup=function(t,i){for(var f,e=this,o=i.findIndex(function(i){return n.sameGroup(i,t.typeWithSource)}),u=!1,s=function(r){var f=i.findIndex(function(t){return n.sameGroup(t,e.groups[r].typeWithSource)});if(f>o)return h.groups.splice(r,0,t),u=!0,"break"},h=this,r=0;r<this.groups.length;r++)if(f=s(r),f==="break")break;u||this.groups.push(t)},t.prototype.handlePendingSubmit=function(t){if(this._pendingSubmitSequenceNumber==this._lastUpdatedSequenceNumber)try{if(this.topResults.length==0)(this.groups.length>0||t.length>0)&&this.showDisableEnterMessage();else{var i=this.topResults[0];return n.InstrumentationHelper.instrumentItemClick(this._pendingSubmitTimeStamp,i.instItem,i.sequenceNumber,i.instrumentPingBack,1,this._pendingSubmitModifierKeys),this._pendingSubmitModifierKeys&&this._pendingSubmitModifierKeys.ctrlKey&&this._pendingSubmitModifierKeys.shiftKey?this.launchVerb(i,p,this._pendingSubmitTimeStamp):this._pendingSubmitModifierKeys&&this._pendingSubmitModifierKeys.shiftKey?this.launchVerb(i,w,this._pendingSubmitTimeStamp):i.click(this._pendingSubmitTimeStamp,0,this._pendingSubmitModifierKeys),0}}finally{this.resetPendingSubmitSequenceNumber()}return 1},t.prototype.showDisableEnterMessage=function(){this._page.showTemporaryMessage(n.Host.getLocString("EnterOnAmbiguousTopHitMessageText"))},t.prototype.showIndexingMessage=function(t){var i=this,r;t?(this._turnOnIndexingInstItem=null,this._launchIndexingDataModel=null):(this._turnOnIndexingInstItem=n.InstrumentedItem.getNonSuggestionInstrumentedItem("IMIO",n.SyntheticQSCodesMaps.KValues),r={id:d,selected:null,text:n.Host.getLocString("WindowsIndexingDisabledAction"),title:null,instItem:this._turnOnIndexingInstItem,click:function(t,r){var u=n.SequenceNumberManager.getSequenceNumber();u>i._lastUpdatedSequenceNumber&&n.InstrumentationHelper.instrumentSyntheticInstrumentedItem(u,"IMIO",i._turnOnIndexingInstItem);n.InstrumentationHelper.instrumentItemClick(t,i._turnOnIndexingInstItem,u,null,r,null);n.LocalDataProvider.launchIndexingOptions(!1)},layout:1,isSelectable:!0});this._launchIndexingDataModel={messageText:t?n.Host.getLocString("WindowsIndexingInProgressMessage"):n.Host.getLocString("WindowsIndexingDisabledMessage"),title:t?n.Host.getLocString("WindowsIndexingInProgressToolTip"):n.Host.getLocString("WindowsIndexingDisabledToolTip"),action:r};this._page.updateIndexingMessageView(this._launchIndexingDataModel)},t.prototype.hideIndexingMessage=function(){this._turnOnIndexingInstItem=null;this._page.updateIndexingMessageView(null)},t.prototype.getAvailableSpace=function(t){var r=this,i;return n.isL2(this._partialQuery)&&this._partialQuery.queryToFetch?Number.MAX_VALUE:(i=this._page.getSuggestionsContainerHeight(),n.config.extraTopPadding&&!n.RuntimeConfig.SearchBoxOnTop&&(i-=n.config.extraTopPadding),n.RuntimeConfig.ScopesAvailable&&(i-=vi),t.topResults.length==0||n.RuntimeConfig.FlatListWithoutGroups||(i-=oi),t.topResults.forEach(function(t){return i-=dt(t,n.isL2(r._partialQuery))}),t.groups.forEach(function(n){return i-=ur(r._partialQuery,n)}),t.groups.some(function(t){return t.typeWithSource&&n.isTopHitChildGroup(t.typeWithSource)})&&t.groups.some(function(t){return t.typeWithSource&&!n.isTopHitChildGroup(t.typeWithSource)})&&(i-=ai),i)},t.prototype.getAvailableSpaceForZeroInputHomeTopSection=function(t,i){var r=this._page.getSuggestionsContainerWidth(),u,f;return r-=n.RuntimeConfig.AlwaysWide?yi:pi,r-=v,u=t?t.suggestions.filter(function(n){return n&&!n.suppressed}).length:0,u+=i.suppressed?0:1,f=n.RuntimeConfig.AlwaysWide?st:wi,r-=(f+v)*u,n.config.useCobaltCSS&&(r+=2*v),r},t.prototype.canFitSuggestion=function(t,r,u){if(u.suppressed||n.getTweakedSetting("scrollBarInL1")||u.handoffType===21&&n.config.msbVerticalChildSuggestionsNoTrim)return!0;var o=kt(this._resultsCounter),f;return t?(f={typeWithSource:r,suggestions:[]},o.groups.push(f)):f=i(o.groups,r),f.suggestions.push({mainTextWrapsToTwoLines:u&&e(u,r.type,!1),isSuppressed:u&&u.suppressed,hasTwoLines:u&&n.contains(u.classNames,"forceNoWrapOutsideTopResult")}),this._partialQuery.isSearchHomeZI?this.canFitSuggestionInZeroInputHome(r,u):this.getAvailableSpace(o)>=0},t.prototype.canFitSuggestionInZeroInputHome=function(t,r){var u,e,o,s,f;return r.type==="SNSC"?!0:n.config.msbEnableQuickWorkSearch&&n.getIsMsbInternalTenant()&&t.type===n.GroupType.QuickWorkSearch?!0:(u=i(this.groups,t),t.type==n.GroupType.MRUHistory)?!0:ti(t.type)?this._partialQuery.scope===n.Scope.All&&n.config.prong1&&t.type==n.GroupType.TopApps?(e=u?u.suggestions.length:0,e<5):n.isWeatherTileVisible(this._lightweightStorage)&&this._partialQuery.scope===n.Scope.All&&n.shouldEnableWeatherTile(n.getCurrentLanguage())?(o=n.config.prong1Menu?0:st,u?this.getAvailableSpaceForZeroInputHomeTopSection(u,r)>=o:!0):this.getAvailableSpaceForZeroInputHomeTopSection(u,r)>=0:t.type===n.GroupType.QuickSearch?(s=n.config.maxQuickSearches+(n.config.resumeSearch?1:0),f=0,SearchAppWrapper.CortanaApp.height<600&&!n.config.useCobaltCSS&&(f=2),(u?u.suggestions.length:0)>=s-f)?!1:!0:t.type===n.GroupType.LockscreenQuickSearch?!0:(u?u.suggestions.length:0)<this.getMaxNumberOfRecentItems(t.type)},t.prototype.getMaxNumberOfRecentItems=function(t){var r,u,i;return t===n.GroupType.MSNNews?5:n.enableProngWeather(n.getCurrentLanguage())&&t===n.GroupType.MRUHistory?(i=SearchAppWrapper.CortanaApp.height,i<600)?4:i<620?6:7:(t==n.GroupType.MRUHistory||t==n.GroupType.RecommendedDocs)&&(r=n.ScopeConfig[n.Scope.All].enabledDataSourcesForZeroInput,u=r.some(function(n){return n&&n.suggestionGroupToggler&&n.suggestionGroupToggler.isHidden()}),n.RuntimeConfig.PreviewPaneAvailable&&n.shouldEnableQuickSearches(n.Host.getLanguage().toLowerCase())&&!u)?n.isL2(this._partialQuery)?10:this._partialQuery.isSearchHomeZI&&n.config.msbHideTopApp&&n.getIsMsbInternalTenant()&&typeof n.isTenantMsbEnabled=="function"&&n.isTenantMsbEnabled()?6:(i=SearchAppWrapper.CortanaApp.height,i<bi?Math.min(2,n.config.activityInZI):i<ki?Math.min(3,n.config.activityInZI):Math.min(4,n.config.activityInZI)):n.config.activityInZI},t.prototype.getMaxNumberOfGroupsToFitMinSuggestionsPerGroup=function(){var i,r,u,t,f;if(n.isL2(this._partialQuery)&&this._partialQuery.queryToFetch||n.getTweakedSetting("scrollBarInL1"))return Number.MAX_VALUE;if(this._partialQuery.isSearchHomeZI)return 4;for(i=kt(this._resultsCounter),r=0,u=i.groups;r<u.length;r++)for(t=u[r];t.suggestions.length<n.config.minSuggestionsPerGroup;)t.suggestions.push(t.suggestions[0]);while(this.getAvailableSpace(i)>0){for(t={suggestions:[]},f=0;f<n.config.minSuggestionsPerGroup;++f)t.suggestions.push({mainTextWrapsToTwoLines:!1,isSuppressed:!1,hasTwoLines:!1});i.groups.push(t)}return i.groups.length-1},t.prototype.onSuggestionAddedToGroup=function(t,r){var f=this,u,o;this.updateNarratorWithPreviewMessage(t);n.isChildSuggestion(t)&&(t.displayed=!0,u=t.parent,t.id=u.id+"_"+u.childSuggestions.indexOf(t),n.isJumpListSuggestion(t)&&t.tooltip===undefined&&n.Async.safeChain("getJumpListDescription",function(){return t.jumpListItem.getDescriptionAsync()},function(i){t.tooltip=i;f.groups.some(function(i){return n.contains(i.suggestions,t)})&&f.renderGroups()}));this.setRemoveIcon(t);o=i(this._resultsCounter.groups,r.typeWithSource);o.suggestions.push({mainTextWrapsToTwoLines:e(t,r.typeWithSource.type,!1),isSuppressed:t.suppressed,hasTwoLines:n.contains(t.classNames,"forceNoWrapOutsideTopResult")});n.displayedInGridLayout(r.typeWithSource.type)&&r.suggestions.filter(function(n){return!n.suppressed}).length>0&&(r.cssClasses+=n.isL2(this._partialQuery)?" gridLayout":" gridLayout gridLayoutMedium")},t.prototype.onGroupsCleared=function(){this._pendingSuggestionsInExistingGroups=[];this._pendingSuggestionsInMissingGroups=[];this._resultsCounter.groups=[];this._turnOnIndexingInstItem&&n.InstrumentationHelper.instrumentSyntheticInstrumentedItem(this._lastUpdatedSequenceNumber,"IMIO",this._turnOnIndexingInstItem)},t.prototype.dismissTour=function(t){var i={query:t.queryToFetch};this._lightweightStorage.setItem("wweTourTook","1");this._lightweightStorage.setItem("wweTourRefreshed","1");this._lightweightStorage.removeItem("wweTourEnabled");_ge("root").classList.remove("overlayEnabled");n.setZeroInputDataSourcesForL1();n.Host.refreshCurrentPane();this._lightweightStorage.removeItem("wweTourRefreshed");n.InstrumentationHelper.logClientInstEvent("Select","WWETourDismiss",null,i)},t.prototype.launchSearch=function(t,i){var r=t.queryToFetch;n.Host.launchSearch(r,this._navigationHelper.getSearchUrl(t.fullPartialQuery,r,i),!1)},t.prototype.setRemoveIcon=function(t){var r=this,u=t.getExtraVerbs&&t.getExtraVerbs(!1).some(function(n){return n.verb=="RemoveFromDeviceHistory"}),o=t.type=="HS"&&n.config.removeSuggUrl,s=n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.forceRemoveIcon,f=t.getExtraVerbs&&t.getExtraVerbs(!1).some(function(n){return n.verb=="RemoveFromDeviceHistoryAll"}),e=t.getExtraVerbs&&t.getExtraVerbs(!1).some(function(n){return n.verb=="RemoveFromWeatherTile"}),i;(s||u||o||f||e)&&(i=f?"RemoveFromDeviceHistoryAll":u?"RemoveFromDeviceHistory":e?"RemoveFromWeatherTile":"RemoveFromWebHistory",t.removeIcon={icon:{content:"&#xE711",type:2},title:n.Host.getLocString(i),click:function(u,f){r._page.hideTemporaryMessage();n.InstrumentationHelper.instrumentItemClickForContextMenu(u,t.instItem,t.sequenceNumber,t.instrumentPingBack,f,null,i);r.launchVerb(t,i,u);n.Host.setFocusInSearchBox(null,"remove")}})},t.prototype.updateNarratorWithPreviewMessage=function(t){var r=n.RuntimeConfig.AlwaysWide?"PreviewPaneButtonNarratorMessageWidePane":"PreviewPaneButtonNarratorMessage",i=n.Host.getLocString(r);t.narratorText&&t.previewPaneType&&t.narratorText.indexOf(i)==-1&&(t.narratorText+=", "+i)},t.prototype.onBeforeRenderTopResults=function(t,i,r,u,f){var e=this,h,c,o,a,v,l,s,y;return this.topResults.forEach(function(n){e.setRemoveIcon(n);e.updateNarratorWithPreviewMessage(n)}),h=1,this.topResults.length!=1||this.topResults[0].hasChildSuggestionsDisplayed||r.some(function(t){return n.isChildSuggestion(t)})&&(this.topResults[0].hasChildSuggestionsDisplayed=!0,h=0),c=this.getSelectableItems(),n.RuntimeConfig.FirstSuggestionSelectedByDefault?(!this._selectedItem||!n.contains(c,this._selectedItem)||this.isScopeElement(this._selectedItem)||this._selectedItem==i[0]&&this.topResults[0]!=i[0]||this._selectedItem!=c[0]||this._selectedItem.previewPaneNeedsRefreshAfterDeduping)&&(o=this._partialQuery.queryToFetch&&this.topResults.length>0?this.topResults[0]:null,n.config.synthWebNoBestMatch&&n.isNullOrUndefined(o)&&(a=[n.GroupType.SearchSuggestions,n.GroupType.Websites],v=r.filter(function(t){return!n.contains(a,n.getGroupType(t))}),v.length==0&&(o=r.length>0?r[0]:null)),this._previewPane&&n.RuntimeConfig.PreviewPaneAvailable&&n.safeExecute(function(){return e._previewPane.onTopHitUpdated(e._partialQuery,e._selectedItem&&e.isSuggestion(e._selectedItem)?e._selectedItem:null,o,e.getSuggestions(!1))},"ppOnTopHitUpdated"),this.select(o,!1),this._page.scrollToTop()):t&&this.select(null,!1),l=this.topResults.length>0,s=function(t){return!t.suppressed&&t.staticGroupType!=n.GroupType.VisualSearch&&(n.RuntimeConfig.QfMode!=6||t.type!="LSQS")},this._headerFooterViewModel&&(y=l||r.some(s)||this.groups.some(function(n){return n.suggestions.some(s)})||this._pendingSuggestionsInMissingGroups.some(function(n){return n.suggestions.some(s)})||this._pendingSuggestionsInExistingGroups.some(function(n){return n.suggestions.some(s)}),this._headerFooterViewModel.render(this._partialQuery,l,y,u,f)),h},t.prototype.isRankable=function(t){return n.config.enableAnaheimRelevance==2?t.typeWithSource.type!=n.GroupType.Websites&&t.typeWithSource.type!=n.GroupType.LocalPlaces&&!t.suggestions.some(n.enforceOriginalOrder):t.typeWithSource.type!=n.GroupType.SearchSuggestions&&t.typeWithSource.type!=n.GroupType.Websites&&t.typeWithSource.type!=n.GroupType.LocalPlaces&&!t.suggestions.some(n.enforceOriginalOrder)},t.prototype.isNotRankableWithRecourse=function(t){return t.typeWithSource.type==n.GroupType.Emails},t.prototype.openPreviewPane=function(t,i){i.stopPropagation();this._previewPane.showPreview(this._partialQuery,t);this.select(t,!0);n.config.reactGroups&&this.selectGroupItem(t);n.Host.setFocusInSearchBox(null,"openPreviewPane")},t.prototype.mayNeedFlush=function(){return!n.RuntimeConfig.FlatListWithoutGroups},t.prototype.update=function(t,i,r,u,f,o,s,h,c,l){var a=this,g=this.topResults,p,nt,tt,w,rt,v,ot,d;if(t&&(this._contentQuery=this._partialQuery,this._renderTopResultsTimerForIcons=null,this._renderGroupsTimerForIcons=null),n.config.enableMRUHint)for(p=0,nt=i;p<nt.length;p++)tt=nt[p],tt.mruHintEnabled&&(tt.uxHint=n.Host.getLocString("MruBestMatch"));var et=this.updateTopResults(t,i,r,u,f,c),it=et[0],ct=et[1];for(ct(),this._resultsCounter.topResults=[],w=0,rt=this.topResults;w<rt.length;w++)v=rt[w],v.previewPaneNeedsRefreshAfterDeduping=!1,ot=1+(v.primaryMetadata?1:0)+(v.secondaryMetadata?1:0),this._resultsCounter.topResults.push({mainTextWrapsToTwoLines:e(v,null,!0),numberOfLines:ot,isHtmlAnswer:!!v.htmlContent,isSuppressed:!1,grid:n.displayedInGridLayout(v.type)});if(this._autoComplete&&this.topResults.length>0&&this._selectedItem==this.topResults[0]&&this._autoComplete.apply(this.topResults[0]),this.handlePendingSubmit(f)==0)return this.toggleProgressBar(!0),0;this._partialQuery&&this._partialQuery.isSearchHomeZI&&this.toggleProgressBar(!c);var ut=!1,b=0,lt=this.createIconRenderInfo(),st=function(){if(ut){var t=a.groups.map(function(n){return n.typeWithSource.type});a._contentQuery.queryToFetch||b!=0||n.InstrumentationHelper.instrumentZiRendered(u);n.InstrumentationHelper.instrumentRenderFinished(u,s,t,b!=0,!a._contentQuery.queryToFetch)}},ft=function(n,t){var r=!1,i;if(a.isRankable(t)&&a._partialQuery&&a._partialQuery.queryToFetch)for(i=0;i<t.suggestions.length;i++)if(n.rankingScore>t.suggestions[i].rankingScore){t.suggestions.splice(i,0,n);r=!0;break}r||t.suggestions.push(n);++b;a.setupIcon(u,n,lt,function(){--b;st()});a.onSuggestionAddedToGroup(n,t)},y=this.getMaxNumberOfGroupsToFitMinSuggestionsPerGroup()-this.groups.length,k=!1,ht=function(){var i,f,t,e;if(y!=0&&r||a.flush(ft,u,h),a.groups.sort(function(t,i){return h.findIndex(function(i){return n.sameGroup(i,t.typeWithSource)})-h.findIndex(function(t){return n.sameGroup(t,i.typeWithSource)})}),a._partialQuery&&a._partialQuery.queryToFetch)for(i=0,f=a.groups;i<f.length;i++)t=f[i],a.isRankable(t)?t.suggestions.sort(function(n,t){return t.rankingScore-n.rankingScore}):a.isNotRankableWithRecourse(t)&&(e=t.suggestions.map(function(n){return n.notAResult}).findIndex(function(n){return n}),e!=-1&&t.suggestions.splice(t.suggestions.length-1,0,t.suggestions.splice(e,1)[0])),a.populateGroupHeaderFlags(t)};return t||f.length>0||o.length>0?(this.renderGroupsAfter(function(){for(var ut,s,c,k,d,v,nt,p,tt,i,w,rt,e=0,b=o;e<b.length;e++)i=b[e],ut=a.removeSuggestion(i,l),ut&&(y+=1);for(s=function(t,i){var e=a.getGroupData(t),f=e[0],r=e[1],o;(n.cohortProfileManager===null||n.cohortProfileManager===void 0?void 0:n.cohortProfileManager.isTourVisible())&&(t.click=undefined,t.tooltip=undefined);r?(r.count&&r.count++,o=n.config.minSuggestionsPerGroup&&!i?n.config.minSuggestionsPerGroup-r.suggestions.length:999,o>0&&a.canFitSuggestion(!1,f,t)?ft(t,r):a._partialQuery.isSearchHomeZI||a.queueSuggestionInExistingGroup(t,r)):y>0&&a.canFitSuggestion(!0,f,t)?(r=a.addGroup(f,t,u,h,l),a.shouldTrackGroupCount(r)&&(r.count=1),ft(t,r),y-=1):a._partialQuery.isSearchHomeZI||a.queueSuggestionInMissingGroup(t,f,l)},c=0,k=g;c<k.length;c++){var et=k[c],ot=a.getGroupData(et),r=ot[1];r&&r.count&&(r.count-=1)}if(d=function(){return a._contentQuery.isSearchHomeZI||n.getTweakedSetting("scrollBarInL1")},it&&!t){for(v=0,nt=f;v<nt.length;v++)i=nt[v],n.contains(g,i)&&s(i,!0);for(p=0,tt=f;p<tt.length;p++)i=tt[p],n.contains(g,i)||s(i,d())}else f.forEach(function(n){return s(n,d())});for(w=0,rt=a.topResults;w<rt.length;w++){var et=rt[w],st=a.getGroupData(et),r=st[1];r&&r.count&&(r.count+=1)}ht()}),k=!0,ut=!0):y!=0&&r||(this._pendingSuggestionsInMissingGroups.some(function(n){return n.suggestions.length>0})||this._pendingSuggestionsInExistingGroups.some(function(n){return n.suggestions.length>0}))&&(this.renderGroupsAfter(function(){return ht()}),k=!0,ut=!0),(it||k)&&(d=void 0,it?k||(d=!0):d=!1,this.resetIconTimers(d,!0)),st(),c&&this.toggleProgressBar(!1),n.config.mruSearchHome&&this._partialQuery.isSearchHomeZI&&this._partialQuery.scope==n.Scope.All&&this.sortMRUList(),1},t.prototype.sortMRUList=function(){var r=this.groups.filter(function(t){return t.type==n.GroupType.MRUHistory}),u=this.groups.filter(function(t){return t.type!=n.GroupType.MRUHistory}),f=this.getMaxNumberOfRecentItems(n.GroupType.MRUHistory),t,i;r.length>0?(this._lightweightStorage.removeItem(pt),t=r[0],t.suggestions.sort(function(n,t){return t.lastLaunchTime-n.lastLaunchTime}),t.suggestions.length>f&&(t.suggestions=t.suggestions.splice(0,f)),i=-1,this.groups.forEach(function(t,r){i=t.type==n.GroupType.MRUHistory?r:i}),u.splice(i,0,t),this.groups=u,this.renderGroups()):this._lightweightStorage.setItem(pt,"1")},t.prototype.canGoToL2=function(n){return n.click&&!n.instItem},t.prototype.populateGroupHeaderFlags=function(n){if(this.canGoToL2(n)){var t=n.suggestions.every(function(n){return n.suppressed});n.showCountInHeader=t}},t.prototype.shouldTrackGroupCount=function(n){return this.canGoToL2(n)},t.prototype.getGroupData=function(t){var r={type:n.getGroupType(t),source:t.sourceForGroup};return n.enableMRUSearchHome()&&r.type==n.GroupType.MRUHistory&&(r.source=undefined),[r,i(this.groups,r)]},t.prototype.removePendingSuggestionFromExistingGroup=function(n,t){for(var r,u,i=0;i<this._pendingSuggestionsInExistingGroups.length;++i)if(r=this._pendingSuggestionsInExistingGroups[i],r.group==t)if(u=r.suggestions.indexOf(n),u==-1)throw new Error("Pending suggestion not found in existing group");else{r.suggestions.splice(u,1);r.suggestions.length==0&&this._pendingSuggestionsInExistingGroups.splice(i,1);return}throw new Error("Pending suggestion not found: pending suggestions in existing groups is empty");},t.prototype.removePendingSuggestionFromMissingGroup=function(t,i){for(var u,f,r=0;r<this._pendingSuggestionsInMissingGroups.length;++r)if(u=this._pendingSuggestionsInMissingGroups[r],n.sameGroup(u.typeWithSource,i))if(f=u.suggestions.indexOf(t),f==-1)throw new Error("Pending suggestion not found in missing group");else{u.suggestions.splice(f,1);u.suggestions.length==0&&this._pendingSuggestionsInMissingGroups.splice(r,1);return}throw new Error("Pending suggestion not found: pending suggestions in missing groups is empty");},t.prototype.queueSuggestionInExistingGroup=function(n,t){var i=gt(this._pendingSuggestionsInExistingGroups,t.typeWithSource);i?i.suggestions.push(n):(i={group:t,suggestions:[n]},this._pendingSuggestionsInExistingGroups.push(i))},t.prototype.queueSuggestionInMissingGroup=function(n,t,r){var u=i(this._pendingSuggestionsInMissingGroups,t);u?u.suggestions.push(n):(u={typeWithSource:t,suggestions:[n],extraSignalsMap:r},this._pendingSuggestionsInMissingGroups.push(u))},t.prototype.partialFlush=function(n,t,i,r){while(n>0&&i.length>0){var u=i[0];this.canFitSuggestion(!1,t.typeWithSource,u)&&r(u,t);i.splice(0,1);n-=1}},t.prototype.flush=function(t,i,r){for(var e,s,u,c,l=this,a=function(u){var o=u.suggestions[0],e;o&&f.canFitSuggestion(!0,u.typeWithSource,o)&&(e=f.addGroup(u.typeWithSource,o,i,r,u.extraSignalsMap),f.shouldTrackGroupCount(e)&&(e.count=u.suggestions.length),f.partialFlush(n.config.minSuggestionsPerGroup,e,u.suggestions,t),u.suggestions.forEach(function(n){return l.queueSuggestionInExistingGroup(n,e)}),u.suggestions=[])},f=this,o=0,h=this._pendingSuggestionsInMissingGroups;o<h.length;o++)u=h[o],a(u);while(this._pendingSuggestionsInExistingGroups.some(function(n){return n.suggestions.length>0}))for(e=0,s=this._pendingSuggestionsInExistingGroups;e<s.length;e++)u=s[e],c=n.config.minSuggestionsPerGroup?1:u.suggestions.length,this.partialFlush(c,u.group,u.suggestions,t)},t.prototype.removeSuggestion=function(t,r){var s={type:n.getGroupType(t),source:t.sourceForGroup},u=i(this.groups,s),f,h,o;if(u)if(n.tryRemove(u.suggestions,t)){if(f=i(this._resultsCounter.groups,u.typeWithSource),h=e(t,u.typeWithSource.type,!1),n.removeFirstWhere(f.suggestions,function(n){return n.mainTextWrapsToTwoLines==h}),n.displayedInGridLayout(u.typeWithSource.type)&&u.suggestions.filter(function(n){return!n.suppressed}).length==0&&(u.cssClasses=""),u.suggestions.length==0)return n.tryRemove(this.groups,u),this._resultsCounter.groups=this._resultsCounter.groups.filter(function(n){return n!=f}),o=gt(this._pendingSuggestionsInExistingGroups,u.typeWithSource),o&&this._pendingSuggestionsInMissingGroups.push({typeWithSource:u.typeWithSource,suggestions:o.suggestions,extraSignalsMap:r}),!0}else this.removePendingSuggestionFromExistingGroup(t,u);else this.removePendingSuggestionFromMissingGroup(t,s);return!1},t.prototype.isScopeElement=function(n){return this._headerFooterViewModel&&this._headerFooterViewModel.isScopeElement(n)},t.prototype.clickedWeatherButton=function(t){var i,r,u;return!this._partialQuery.isSearchHomeZI||this._partialQuery.queryToFetch!=""||!n.shouldEnableWeatherTile(n.getCurrentLanguage())&&!n.enableProngWeather(n.getCurrentLanguage())?!1:(r=(i=t.target)===null||i===void 0?void 0:i.className.split(" ")[0],u=["secondaryUnit","icon","iconContent","actionsMenu"],t.target&&u.indexOf(r)!=-1)},t.prototype.createIconRenderInfo=function(n){var t={iconsPendingReturn:0,isTopResult:n};return this._iconRenderInfos.push(t),t},t.prototype.getCurrentTopResults=function(){return this.topResults.slice(0)},t.prototype.getTopResultsWhichFitInCanvas=function(n){return n},t.prototype.resetAriaSelected=function(n){n&&this._page.render(function(){var t=_ge(n.id);t&&(t.setAttribute("aria-selected","false"),t.setAttribute("aria-selected","true"))})},t.prototype.updateTopResults=function(t,i,r,u,f,e){var h=this,a,o,s,y;t!=(u!=this._lastUpdatedSequenceNumber)&&SharedLogHelper.LogError("updateTopResult",t+" != (sequenceNumber "+u+" != lastUpdateSequenceNumber "+this._lastUpdatedSequenceNumber+")",new Error("Precondition failed"));this._lastUpdatedSequenceNumber=u;t&&(this.groups=[],this.onGroupsCleared());a=this._selectedItem;o=this.topResults;i=this.getTopResultsWhichFitInCanvas(i);s=!n.sequenceEqual(i,o)||o.some(function(n){return n.needsRefreshAfterDeduping});s&&(this.topResults=i.slice(0));var c=!1,l=s?i.length:0,p=this.createIconRenderInfo(!0),v=function(){c&&(n.config.enableLocalInstrumentation&&n.InstrumentationHelper.instrumentRenderedLocalSuggestion(u,i),n.InstrumentationHelper.instrumentTopResultRendered(u,i.map(function(n){return n.type}),l!=0))};return s?(this.renderTopResultsAfter(function(){for(var s,i=0,c=h.topResults;i<c.length;i++)s=c[i],s.needsRefreshAfterDeduping=!1,n.contains(o,s)?l-=1:h.setupIcon(u,s,p,function(){l-=1;v()});h.onBeforeRenderTopResults(t,o,f,r,e)}),c=!0):(y=this.onBeforeRenderTopResults(t,o,f,r,e),y==0&&(this.renderTopResults(),c=!0)),this._selectedItem&&(a!=this._selectedItem||t)&&n.contains(this.topResults,this._selectedItem)&&this.resetAriaSelected(this._selectedItem),[s,v]},t.prototype.renderGroupsAfter=function(n){var t=this._groupRenderingDisabled;this._groupRenderingDisabled=!0;try{n()}finally{this._groupRenderingDisabled=t;this.renderGroups()}},t.prototype.renderTopResults=function(t){this._topResultsRenderingDisabled||(this._page.updateTopResultsView({query:this._contentQuery,topResults:this.topResults,groups:this.groups},t),n.InstrumentationHelper.updateSuggestionsList(this.topResults,this.groups))},t.prototype.renderTopResultsAfter=function(n){var u=this._topResultsRenderingDisabled,t,i,r;this._topResultsRenderingDisabled=!0;try{n()}finally{for(this._topResultsRenderingDisabled=u,this.renderTopResults(),t=0,i=this.topResults;t<i.length;t++)r=i[t],r.executeScript&&r.executeScript()}},t}();n.RootViewModel=ui})(WSB||(WSB={}))